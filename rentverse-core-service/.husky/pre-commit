#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Color definitions
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
NC='\033[0m' # No Color

# Print header
printf "${BLUE}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}\n"
printf "${BLUE}â•‘${WHITE}                           ğŸ”§ PRE-COMMIT HOOKS                               ${BLUE}â•‘${NC}\n"
printf "${BLUE}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}\n"
printf "\n"

printf "${CYAN}ğŸ¯ Processing staged files...${NC}\n"
printf "${YELLOW}â³ Running linting and formatting on changed files...${NC}\n"
printf "\n"

# Run lint-staged to check and fix only staged files
npx lint-staged

if [ $? -ne 0 ]; then
  printf "\n"
  printf "${RED}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}\n"
  printf "${RED}â•‘${WHITE}                                âŒ FAILURE                                   ${RED}â•‘${NC}\n"
  printf "${RED}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}\n"
  printf "${RED}ğŸ’¥ Pre-commit validation failed!${NC}\n"
  printf "\n"
  printf "${YELLOW}ğŸ’¡ Tips:${NC}\n"
  printf "${WHITE}   â€¢ Check the errors above and fix them manually${NC}\n"
  printf "${WHITE}   â€¢ Some issues might be auto-fixed already${NC}\n"
  printf "${WHITE}   â€¢ Re-stage your files: ${CYAN}git add .${NC}\n"
  printf "\n"
  printf "${RED}ğŸš« Commit aborted. Please fix the issues and try again.${NC}\n"
  exit 1
fi

printf "\n"
printf "${GREEN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}\n"
printf "${GREEN}â•‘${WHITE}                               âœ… SUCCESS                                    ${GREEN}â•‘${NC}\n"
printf "${GREEN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}\n"
printf "${GREEN}ğŸŠ Pre-commit validation completed successfully!${NC}\n"
printf "${CYAN}ğŸ“ Your staged files are clean and ready to commit.${NC}\n"
printf "\n"
printf "${PURPLE}ğŸ” What was checked:${NC}\n"
printf "${WHITE}   âœ“ Code linting (ESLint)${NC}\n"
printf "${WHITE}   âœ“ Code formatting (Prettier)${NC}\n"
printf "${WHITE}   âœ“ File quality standards${NC}\n"
printf "\n"